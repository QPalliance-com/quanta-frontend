<div class="card flex flex-col gap-4">
    <div *ngFor="let item of itemsFormArray.controls; let i = index" [formGroup]="item" class="grid grid-cols-12 gap-2 items-end content-center">
        <div class="col-span-2">
            <label class="block text-xs font-medium text-gray-700 mb-1">Producto</label>
            <p-autoComplete field="name" minLength="1" [suggestions]="productOptions" (completeMethod)="searchProducts($event)" (onSelect)="onProductSelect(i, $event.value)" formControlName="name" placeholder="Producto" class="w-full" />
        </div>
        <div class="col-span-2">
            <label class="block text-xs font-medium text-gray-700 mb-1">Unidad</label>
            <input pInputText formControlName="unit" placeholder="Unidad" class="w-full" />
        </div>
        <div class="col-span-2">
            <label class="block text-xs font-medium text-gray-700 mb-1">Cantidad</label>
            <input pInputText type="number" formControlName="quantity" placeholder="Cantidad" class="w-full" />
        </div>
        <div class="col-span-2">
            <label class="block text-xs font-medium text-gray-700 mb-1">Precio</label>
            <input pInputText type="number" formControlName="unitPrice" placeholder="Precio" class="w-full" />
        </div>
        <div class="col-span-2">
            <label class="block text-xs font-medium text-gray-700 mb-1">Subtotal</label>
            <input pInputText type="number" placeholder="Subtotal" class="w-full" [value]="item.value.quantity * item.value.unitPrice || 0" readonly />
        </div>
        <div class="col-span-2 flex gap-1 items-end">
            <label class="block text-xs font-medium text-gray-700 mb-1">&nbsp;</label>
            <button pButton icon="pi pi-trash" class="p-button-danger" *ngIf="i > 0" (click)="removeItem(i)" type="button"></button>
        </div>
        <div class="col-span-12">
            <label class="block text-xs font-medium text-gray-700 mb-1">Observaciones</label>
            <input pInputText formControlName="observations" placeholder="Observaciones" class="w-full" />
        </div>
    </div>

    <button pButton label="Agregar Ítem" icon="pi pi-plus" class="w-full" (click)="addItem()" type="button"></button>

    <!-- Subtotal general -->
    <div class="flex justify-end mt-4">
        <div class="bg-gray-100 rounded px-6 py-3 flex items-center gap-4">
            <span class="font-semibold text-gray-700">Subtotal de ítems:</span>
            <span class="text-lg font-bold text-gray-900">
                {{ totalItemsSubtotal | currency: 'COP' : 'symbol' }}
            </span>
        </div>
    </div>
</div>
